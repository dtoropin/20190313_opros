!function(){var a=$(".addAnswer"),t=$(".close"),n=$(".modal-btn"),e=$(".tab-questions__add"),s=$("#tableAnswers"),i=$("#tableQuestions"),o=$("#questionForm"),d=$(".modal-title"),l="/admin/",r=null,c=function(){i.empty();runAjax("/admin/question/",null).done(function(a){i.append('<div class="tab-questions__show-row"><div class="tab-questions__show-number">#</div><div class="tab-questions__show-question">Вопрос</div><div class="tab-questions__show-answer">Ответы</div><div class="tab-questions__show-right">Прав. ответ (№)</div><div class="tab-questions__show-action">Act.</div></div>'),$.each(a.row,function(a,t){var n='<div class="tab-questions__show-row"><div class="tab-questions__show-number">#'+(a+1)+'</div><div class="tab-questions__show-question">'+t.questions+'</div><div class="tab-questions__show-answer">';$.each(t.answers.split(";"),function(a,t){n+="<p>"+(a+1)+". "+t+"</p>"}),n+='</div><div class="tab-questions__show-right">'+t.right+'</div><div class="tab-questions__show-action"><img src="img/edit.png" class="modal__edit" alt="edit" data-id="'+t.id+'" data-toggle="modal" data-target="#questionModal"><img src="img/trash.png" class="modal__delete" alt="recycle" data-id="'+t.id+'"></div></div>',i.append(n)})}).fail(function(){i.append('<tr><td colspan="5">Вопросов пока нет..</td></tr>')})},u=function(){n.on("click",v),t.on("click",w),a.on("click",m),i.on("click",".modal__delete",h),i.on("click",".modal__edit",g),e.on("click",f)},v=function(a){a.preventDefault(),n.hasClass("modal-edit")&&q(),n.hasClass("modal-save")&&_()},f=function(){p(1),n.addClass("modal-save"),d.text("Добавление вопроса")},m=function(a){a.preventDefault(),p(r)},p=function(t){if(6===t)return a.prop("disabled",!0),!1;a.prop("disabled",!1);var n='<div class="form-group answer"><label>Ответ '+t+'<input type="text" name="answer'+t+'"\tclass="form-control" placeholder="Ответ на вопрос"></label></div>';$(".rowanswer").append(n),r=t+1},h=function(a){if(!confirm("Подтвердите удаление."))return!1;var t=$(a.target).attr("data-id");runAjax(l+"delete/"+t,null).done(function(){c()}).fail(function(){console.log("error")})},_=function(){var a=o.serialize();runAjax("/admin/add/",a).done(function(){c(),w(),$("#questionModal").modal("hide")}).fail(function(){console.log("error")})},w=function(){$("#questionForm").trigger("reset"),$(".answer").remove(),n.removeClass("modal-save modal-edit"),r=null,a.prop("disabled",!1)},g=function(a){n.addClass("modal-edit"),d.text("Редактирование вопроса");var t=$(".rowanswer"),e=$(".modal-question"),s=$(".modal-answerright"),i=$(a.target).attr("data-id");runAjax(l+"getOne/"+i,null).done(function(a){$(".modal-id").val(a.question[0].id),e.val(a.question[0].questions);var n=a.question[0].answers.split(";");$.each(n,function(a,n){var e='<div class="form-group answer"><label>Ответ '+(a+1)+'<input type="text" name="answer'+(a+1)+'"\tclass="form-control" placeholder="Ответ на вопрос" value="'+n+'"></label></div>';t.append(e),r=a+2}),s.val(a.question[0].right)}).fail(function(){console.log("error")})},q=function(){var a=o.serialize();runAjax("/admin/edit/",a).done(function(){c(),w(),$("#questionModal").modal("hide")}).fail(function(){console.log("error")})};(function(){runAjax("/admin/answer/",null).done(function(a){s.append('<tr><th>#</th><th class="table-FIO">ФИО</th><th>Правильных ответов</th></tr>'),$.each(a.row,function(a,t){var n='<tr class="table-'+(t.right>=87?"success":"danger")+'"><td>'+(a+1)+'</td><td class="text-capitalize">'+t.surname+" "+t.name+"</td><td>"+t.right+"%</td></tr>";s.append(n)})}).fail(function(){s.append('<tr><td colspan="3">Ответов пока нет..</td></tr>')})})(),c(),u()}();