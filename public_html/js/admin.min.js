!function(){var n=$(".addAnswer"),a=$(".close"),o=$(".modal-btn"),i=$(".tab-questions__add"),s=$(".tab-questions__show"),e=$(".accordion"),t=$("#questionForm"),d=$(".modal-title"),l=$(".tab-pane__badge"),c=null,r="/admin/",u=null,v=function(){runAjax("/admin/answer/",null).done(function(n){c=n.row.length;e.append('<div class="accordion__row"><div class="accordion__number">#</div><div class="accordion__FIO">ФИО</div><div class="accordion__right">Пра&shy;виль&shy;ных отве&shy;тов</div></div>'),$.each(n.row,function(n,a){var o='<div class="accordion__row-answer accordion__row-answer--'+(a.right>=87?"success":"danger")+'"><div class="accordion__number">'+(n+1)+'</div><div class="accordion__FIO">'+a.surname+" "+a.name+'</div><div class="accordion__right">'+a.right+'%</div></div><div class="accordion__collapse">';if(""!==a.wrong){var i=a.wrong.indexOf(";")>-1?a.wrong.split(";"):Array(a.wrong);$.each(i,function(n,a){var i=a.split("||");o+='<p class="text-black-50">'+(n+1)+".&nbsp;"+i[0]+':</p><p class="accordion__text-success text-success">&nbsp;- '+i[1]+'</p><p class="accordion__text-danger text-danger">&nbsp;- '+i[2]+"</p>"})}o+="</div>",e.append(o)})}).fail(function(){e.append('<div class="accordion__row">Ответов пока нет..</div>')})},_=function(){s.empty();runAjax("/admin/question/",null).done(function(n){s.append('<div class="tab-questions__show-row"><div class="tab-questions__show-number">#</div><div class="tab-questions__show-question">Вопрос</div><div class="tab-questions__show-answer">Ответы</div><div class="tab-questions__show-right">Прав. ответ (№)</div><div class="tab-questions__show-action">Act.</div></div>'),$.each(n.row,function(n,a){var o='<div class="tab-questions__show-row"><div class="tab-questions__show-number">#'+(n+1)+'</div><div class="tab-questions__show-question">'+a.questions+'</div><div class="tab-questions__show-answer">';$.each(a.answers.split(";"),function(n,a){o+="<p>"+(n+1)+".&nbsp;"+a+"</p>"}),o+='</div><div class="tab-questions__show-right">'+a.right+'</div><div class="tab-questions__show-action"><img src="img/edit.png" class="modal__edit" alt="edit" data-id="'+a.id+'" data-toggle="modal" data-target="#questionModal"><img src="img/trash.png" class="modal__delete" alt="recycle" data-id="'+a.id+'"></div></div>',s.append(o)})}).fail(function(){s.append('<div class="tab-questions__show-row">Вопросов пока нет..</div>')})},p=function(){o.on("click",g),a.on("click",k),n.on("click",b),s.on("click",".modal__delete",x),s.on("click",".modal__edit",y),i.on("click",h),e.on("click",".accordion__row-answer",m),l.on("click",w)},f=function(){setInterval(function(){runAjax("/admin/countall/",null).done(function(n){n.countall>c&&l.text(n.countall-c).show()}).fail(function(){console.log("error")})},3e4)},w=function(){l.text("").hide(),e.empty(),v()},m=function(){$(this).next(".accordion__collapse").slideToggle().siblings(".accordion__collapse:visible").slideUp()},g=function(n){n.preventDefault(),o.hasClass("modal-edit")&&j(),o.hasClass("modal-save")&&A()},h=function(){q(1),o.addClass("modal-save"),d.text("Добавление вопроса")},b=function(n){n.preventDefault(),q(u)},q=function(a){if(6===a)return n.prop("disabled",!0),!1;n.prop("disabled",!1);var o='<div class="form-group answer"><label>Ответ '+a+'<input type="text" name="answer'+a+'"\tclass="form-control" placeholder="Ответ на вопрос"></label></div>';$(".rowanswer").append(o),u=a+1},x=function(n){if(!confirm("Подтвердите удаление."))return!1;var a=$(n.target).attr("data-id");runAjax(r+"delete/"+a,null).done(function(){_()}).fail(function(){console.log("error")})},A=function(){var n=t.serialize();runAjax("/admin/add/",n).done(function(){_(),k(),$("#questionModal").modal("hide")}).fail(function(){console.log("error")})},k=function(){$("#questionForm").trigger("reset"),$(".answer").remove(),o.removeClass("modal-save modal-edit"),u=null,n.prop("disabled",!1)},y=function(n){o.addClass("modal-edit"),d.text("Редактирование вопроса");var a=$(".rowanswer"),i=$(".modal-question"),s=$(".modal-answerright"),e=$(n.target).attr("data-id");runAjax(r+"getOne/"+e,null).done(function(n){$(".modal-id").val(n.question[0].id),i.val(n.question[0].questions);var o=n.question[0].answers.split(";");$.each(o,function(n,o){var i='<div class="form-group answer"><label>Ответ '+(n+1)+'<input type="text" name="answer'+(n+1)+'"\tclass="form-control" placeholder="Ответ на вопрос" value="'+o+'"></label></div>';a.append(i),u=n+2}),s.val(n.question[0].right)}).fail(function(){console.log("error")})},j=function(){var n=t.serialize();runAjax("/admin/edit/",n).done(function(){_(),k(),$("#questionModal").modal("hide")}).fail(function(){console.log("error")})};v(),_(),p(),f()}();