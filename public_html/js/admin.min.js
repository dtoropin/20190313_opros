!function(){var n=$(".addAnswer"),o=$(".close"),a=$(".modal-btn"),i=$(".tab-questions__add"),s=$(".tab-questions__show"),e=$(".accordion"),t=$("#questionForm"),d=$(".modal-title"),l=$(".tab-pane__badge"),c=null,r="/admin/",u=null,v=function(){runAjax("/admin/answer/",null).done(function(n){c=n.row.length;e.append('<div class="accordion__row"><div class="accordion__number">#</div><div class="accordion__FIO">ФИО</div><div class="accordion__right">Пра&shy;виль&shy;ных отве&shy;тов</div></div>'),$.each(n.row,function(n,o){var a='<div class="accordion__row-answer accordion__row-answer--'+(o.right>=87?"success":"danger")+'"><div class="accordion__number">'+(n+1)+'</div><div class="accordion__FIO">'+o.surname+" "+o.name+'</div><div class="accordion__right">'+o.right+'%</div></div><div class="accordion__collapse">';if(""!==o.wrong){var i=o.wrong.indexOf(";")>-1?o.wrong.split(";"):Array(o.wrong);$.each(i,function(n,o){var i=o.split("::");a+='<p class="text-black-50">'+(n+1)+".&nbsp;"+i[0]+':</p><p class="accordion__text-danger text-danger">&nbsp;- '+i[1]+"</p>"})}a+="</div>",e.append(a)})}).fail(function(){e.append('<div class="accordion__row">Ответов пока нет..</div>')})},_=function(){s.empty();runAjax("/admin/question/",null).done(function(n){s.append('<div class="tab-questions__show-row"><div class="tab-questions__show-number">#</div><div class="tab-questions__show-question">Вопрос</div><div class="tab-questions__show-answer">Ответы</div><div class="tab-questions__show-right">Прав. ответ (№)</div><div class="tab-questions__show-action">Act.</div></div>'),$.each(n.row,function(n,o){var a='<div class="tab-questions__show-row"><div class="tab-questions__show-number">#'+(n+1)+'</div><div class="tab-questions__show-question">'+o.questions+'</div><div class="tab-questions__show-answer">';$.each(o.answers.split(";"),function(n,o){a+="<p>"+(n+1)+".&nbsp;"+o+"</p>"}),a+='</div><div class="tab-questions__show-right">'+o.right+'</div><div class="tab-questions__show-action"><img src="img/edit.png" class="modal__edit" alt="edit" data-id="'+o.id+'" data-toggle="modal" data-target="#questionModal"><img src="img/trash.png" class="modal__delete" alt="recycle" data-id="'+o.id+'"></div></div>',s.append(a)})}).fail(function(){s.append('<div class="tab-questions__show-row">Вопросов пока нет..</div>')})},f=function(){a.on("click",g),o.on("click",k),n.on("click",b),s.on("click",".modal__delete",x),s.on("click",".modal__edit",y),i.on("click",h),e.on("click",".accordion__row-answer",m),l.on("click",w)},p=function(){setInterval(function(){runAjax("/admin/countall/",null).done(function(n){console.log(n.countall),n.countall>c&&l.text(n.countall-c).show()}).fail(function(){console.log("error")})},3e4)},w=function(){l.text("").hide(),e.empty(),v()},m=function(){$(this).next(".accordion__collapse").slideToggle().siblings(".accordion__collapse:visible").slideUp()},g=function(n){n.preventDefault(),a.hasClass("modal-edit")&&j(),a.hasClass("modal-save")&&A()},h=function(){q(1),a.addClass("modal-save"),d.text("Добавление вопроса")},b=function(n){n.preventDefault(),q(u)},q=function(o){if(6===o)return n.prop("disabled",!0),!1;n.prop("disabled",!1);var a='<div class="form-group answer"><label>Ответ '+o+'<input type="text" name="answer'+o+'"\tclass="form-control" placeholder="Ответ на вопрос"></label></div>';$(".rowanswer").append(a),u=o+1},x=function(n){if(!confirm("Подтвердите удаление."))return!1;var o=$(n.target).attr("data-id");runAjax(r+"delete/"+o,null).done(function(){_()}).fail(function(){console.log("error")})},A=function(){var n=t.serialize();runAjax("/admin/add/",n).done(function(){_(),k(),$("#questionModal").modal("hide")}).fail(function(){console.log("error")})},k=function(){$("#questionForm").trigger("reset"),$(".answer").remove(),a.removeClass("modal-save modal-edit"),u=null,n.prop("disabled",!1)},y=function(n){a.addClass("modal-edit"),d.text("Редактирование вопроса");var o=$(".rowanswer"),i=$(".modal-question"),s=$(".modal-answerright"),e=$(n.target).attr("data-id");runAjax(r+"getOne/"+e,null).done(function(n){$(".modal-id").val(n.question[0].id),i.val(n.question[0].questions);var a=n.question[0].answers.split(";");$.each(a,function(n,a){var i='<div class="form-group answer"><label>Ответ '+(n+1)+'<input type="text" name="answer'+(n+1)+'"\tclass="form-control" placeholder="Ответ на вопрос" value="'+a+'"></label></div>';o.append(i),u=n+2}),s.val(n.question[0].right)}).fail(function(){console.log("error")})},j=function(){var n=t.serialize();runAjax("/admin/edit/",n).done(function(){_(),k(),$("#questionModal").modal("hide")}).fail(function(){console.log("error")})};v(),_(),f(),p()}();