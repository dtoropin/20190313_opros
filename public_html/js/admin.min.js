!function(){var a=$(".addAnswer"),i=$(".close"),n=$(".modal-btn"),o=$(".tab-questions__add"),s=$(".tab-questions__show"),e=$(".accordion"),t=$("#questionForm"),d=$(".modal-title"),l="/admin/",c=null,r=function(){s.empty();runAjax("/admin/question/",null).done(function(a){s.append('<div class="tab-questions__show-row"><div class="tab-questions__show-number">#</div><div class="tab-questions__show-question">Вопрос</div><div class="tab-questions__show-answer">Ответы</div><div class="tab-questions__show-right">Прав. ответ (№)</div><div class="tab-questions__show-action">Act.</div></div>'),$.each(a.row,function(a,i){var n='<div class="tab-questions__show-row"><div class="tab-questions__show-number">#'+(a+1)+'</div><div class="tab-questions__show-question">'+i.questions+'</div><div class="tab-questions__show-answer">';$.each(i.answers.split(";"),function(a,i){n+="<p>"+(a+1)+".&nbsp;"+i+"</p>"}),n+='</div><div class="tab-questions__show-right">'+i.right+'</div><div class="tab-questions__show-action"><img src="img/edit.png" class="modal__edit" alt="edit" data-id="'+i.id+'" data-toggle="modal" data-target="#questionModal"><img src="img/trash.png" class="modal__delete" alt="recycle" data-id="'+i.id+'"></div></div>',s.append(n)})}).fail(function(){s.append('<div class="tab-questions__show-row">Вопросов пока нет..</div>')})},u=function(){n.on("click",_),i.on("click",h),a.on("click",f),s.on("click",".modal__delete",m),s.on("click",".modal__edit",b),o.on("click",p),e.on("click",".accordion__row-answer",v)},v=function(){$(this).next(".accordion__collapse").slideToggle().siblings(".accordion__collapse:visible").slideUp()},_=function(a){a.preventDefault(),n.hasClass("modal-edit")&&q(),n.hasClass("modal-save")&&g()},p=function(){w(1),n.addClass("modal-save"),d.text("Добавление вопроса")},f=function(a){a.preventDefault(),w(c)},w=function(i){if(6===i)return a.prop("disabled",!0),!1;a.prop("disabled",!1);var n='<div class="form-group answer"><label>Ответ '+i+'<input type="text" name="answer'+i+'"\tclass="form-control" placeholder="Ответ на вопрос"></label></div>';$(".rowanswer").append(n),c=i+1},m=function(a){if(!confirm("Подтвердите удаление."))return!1;var i=$(a.target).attr("data-id");runAjax(l+"delete/"+i,null).done(function(){r()}).fail(function(){console.log("error")})},g=function(){var a=t.serialize();runAjax("/admin/add/",a).done(function(){r(),h(),$("#questionModal").modal("hide")}).fail(function(){console.log("error")})},h=function(){$("#questionForm").trigger("reset"),$(".answer").remove(),n.removeClass("modal-save modal-edit"),c=null,a.prop("disabled",!1)},b=function(a){n.addClass("modal-edit"),d.text("Редактирование вопроса");var i=$(".rowanswer"),o=$(".modal-question"),s=$(".modal-answerright"),e=$(a.target).attr("data-id");runAjax(l+"getOne/"+e,null).done(function(a){$(".modal-id").val(a.question[0].id),o.val(a.question[0].questions);var n=a.question[0].answers.split(";");$.each(n,function(a,n){var o='<div class="form-group answer"><label>Ответ '+(a+1)+'<input type="text" name="answer'+(a+1)+'"\tclass="form-control" placeholder="Ответ на вопрос" value="'+n+'"></label></div>';i.append(o),c=a+2}),s.val(a.question[0].right)}).fail(function(){console.log("error")})},q=function(){var a=t.serialize();runAjax("/admin/edit/",a).done(function(){r(),h(),$("#questionModal").modal("hide")}).fail(function(){console.log("error")})};(function(){runAjax("/admin/answer/",null).done(function(a){e.append('<div class="accordion__row"><div class="accordion__number">#</div><div class="accordion__FIO">ФИО</div><div class="accordion__right">Пра&shy;виль&shy;ных отве&shy;тов</div></div>'),$.each(a.row,function(a,i){var n='<div class="accordion__row-answer accordion__row-answer--'+(i.right>=87?"success":"danger")+'"><div class="accordion__number">'+(a+1)+'</div><div class="accordion__FIO">'+i.surname+" "+i.name+'</div><div class="accordion__right">'+i.right+'%</div></div><div class="accordion__collapse">';if(""!==i.wrong){var o=i.wrong.indexOf(";")>-1?i.wrong.split(";"):Array(i.wrong);$.each(o,function(a,i){var o=i.split("::");n+='<p class="text-black-50">'+(a+1)+".&nbsp;"+o[0]+':</p><p class="accordion__text-danger text-danger">&nbsp;- '+o[1]+"</p>"})}n+="</div>",e.append(n)})}).fail(function(){e.append('<div class="accordion__row">Ответов пока нет..</div>')})})(),r(),u()}();